# Lab5 实验文档

## Lab5 实验说明

本次实验主题为数据库故障恢复，要求同学们通过 WAL 机制，实现简单的故障恢复功能，实验前可先复习一下 WAL，Steal/No-steal，Force/No-force 策略的相关理论。

实验前先合并 lab5 新增的实验代码，若合并出现冲突需手动解决，合并后确保不影响前 4 次实验测试的正确性。

## 框架主要变更

新增类：RecoveryManager。

## Lab5 需要实现的接口

- manager
  
  - RecoveryManager：恢复管理器
    - Redo
    - Undo

本次实验为本学期最后一次实验，实现灵活性较大，只要不影响外部接口，可根据自己的实现方案调整内部逻辑，实现过程中可能需要设计新的类。

## 测试说明

当前实验框架下，难以模拟出真实场景下数据库故障场景。在本实验中，通过 `delete db` 模拟数据库异常关机场景，通过 `db = new Instance()` 模拟数据库开机重启场景，重启后分别调用 RecoveryManager 的 Redo 和 Undo 函数，根据记录的日志进行数据库数据恢复操作，恢复后要求关机前已提交的事务所作的修改持久化到数据库中，而未提交的事务所作的修改需全部回滚。具体可参考测试代码。

由于测试数据量较小，无法体现出 Steal 和 No-force 策略的优势，因此不要求一定采用大部分现代数据库使用的 Steal/No-force 策略，如果采用的是别的策略，请在报告中说明该策略可能出现的问题。

为减轻期末负担，测例中仅包含 Insert 操作相关测试，对其他操作（如 delete，create table 等）的故障恢复不做要求，感兴趣的同学可自行实现。

## Lab5 报告说明

在报告中描述你的故障恢复实现方案，遇到的难点和关键点等。如果你采用的不是 Steal/No-force 策略，请说明你的方法在什么场合下可能出现什么样的问题，以及如果要实现 Steal/No-force 策略，你的方案还需要做哪些修改。

（选做）感兴趣的同学可以了解一下故障恢复经典算法 ARIES，对比 ARIES 算法和你实现的算法的区别。参考资料：[PPT](https://15445.courses.cs.cmu.edu/fall2020/slides/21-recovery.pdf)，[中文笔记](https://zhenghe.gitbook.io/open-courses/cmu-15-445-645-database-systems/database-recovery)。

一门好的课程实验，都是需要多年学生的吐槽和反馈、多届助教和老师一起提升的，国内外高校许多经典的课程实验都经历了几十年的打磨和改良。本门课程实验在今年进行第一次大规模课改，过程中也出现了许多问题，给同学们带来了一些不好的体验。最后一次实验报告中，我们非常希望同学们可以表达对这门课程的看法，如课程安排是否合理，每次实验的难度和工作量如何，收获有多大，以及你对课程的建议等。未来这门课程也会根据大家的建议不断更新和改良，给同学们带来更好的体验。

## Lab5 截止时间

2021 年 6 月 6 日（第 15 周周日）晚 23:59 分前。

届时网络学堂会布置作业，在作业中提交报告和实验 5 最终版本 CI 测试的 job id。
